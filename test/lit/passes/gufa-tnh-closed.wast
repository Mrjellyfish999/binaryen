;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; RUN: foreach %s %t wasm-opt -all --gufa -tnh --closed-world -S -o - | filecheck %s

;; A CallRef with no non-trapping targets must be unreachable if traps never
;; happen, in a closed world, which is what this file tests.
(module
  (rec
    (type $A (func))
    (type $B (func))
  )

  (func $impossible (type $A)
    ;; This cannot be called if traps never happen.
    (unreachable)
  )

  (func $irrelevant (type $B)
    ;; This has a similar but different type, so it is irrelevant to this
    ;; optimization.
    (drop
      (i32.const 20)
    )
  )

  (func $caller (export "out") (param $x (ref null $A))
    ;; This call must trap: the only function of the right type will trap.
    (call_ref $A
      (local.get $x)
    )
  )
)
