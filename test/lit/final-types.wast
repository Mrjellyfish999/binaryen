;; NOTE: Assertions have been generated by update_lit_checks.py and should not be edited.

;; RUN: wasm-opt %s -all -S -o - | filecheck %s
;; RUN: wasm-opt %s -all --roundtrip -S -o - | filecheck %s

;; RUN: wasm-opt %s -all -S -o - --standard-final-types | filecheck %s --check-prefix=FINAL
;; RUN: wasm-opt %s -all --roundtrip -S -o - --standard-final-types | filecheck %s --check-prefix=FINAL

;; Test that the shorthand type declaration format is considered final if and
;; only if --standard-final-types is supplied.

(module
  ;; CHECK:      (type $short (struct ))
  (type $short (struct))
  ;; CHECK:      (type $long (sub final (struct )))
  ;; FINAL:      (type $long (struct ))
  (type $long (sub final (struct)))

  ;; CHECK:      (func $test (type $none_=>_none)
  ;; CHECK-NEXT:  (drop
  ;; CHECK-NEXT:   (ref.cast $long
  ;; CHECK-NEXT:    (struct.new_default $short)
  ;; CHECK-NEXT:   )
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT: )
  ;; FINAL:      (func $test (type $none_=>_none)
  ;; FINAL-NEXT:  (drop
  ;; FINAL-NEXT:   (ref.cast $long
  ;; FINAL-NEXT:    (struct.new_default $long)
  ;; FINAL-NEXT:   )
  ;; FINAL-NEXT:  )
  ;; FINAL-NEXT: )
  (func $test
    (drop
      (ref.cast $long
        (struct.new_default $short)
      )
    )
  )
)
